const DATA = {"maps":[
	{"map_name":"A Balanced AI Generated Chile","map_id":"6430f6ae803b91d398056286","user_name":"John Harvey Kellogg","count":107581,"type":"Generated","category":"Country","country":"Chile","country_code":"CL","tags":["South America"],"updated":"2024-03-03T10:46:56.2890000Z"},
	{"map_name":"A Balanced AI Generated India","map_id":"62e10035c97fc44e29bd8e0e","user_name":"John Harvey Kellogg","count":107454,"type":"Generated","category":"Country","country":"India","country_code":"IN","tags":["Asia"],"updated":"2024-02-23T00:22:24.6820000Z"},
	{"map_name":"A Balanced Australia","map_id":"60afb9b2dcdbe60001438fa6","user_name":"slashP","count":85567,"type":"Generated","category":"Country","country":"Australia","country_code":"AU","tags":["Oceania"],"updated":"2024-04-03T03:09:14.7240000Z"},
	{"map_name":"A Balanced Brazil","map_id":"61df8477a94f5d0001ef9f2c","user_name":"Steve","count":99996,"type":"Generated","category":"Country","country":"Brazil","country_code":"BR","tags":["South America"],"updated":"2024-03-12T22:25:23.2950000Z"},
	{"map_name":"A Balanced Canada","map_id":"61067f9608061c000157a851","user_name":"slashP","count":64875,"type":"Generated","category":"Country","country":"Canada","country_code":"CA","tags":["North America"],"updated":"2024-04-03T03:16:38.8590000Z"},
	{"map_name":"A Balanced Colombia","map_id":"63c0a65c985b2d9d2425c6a1","user_name":"Melting Ice","count":90792,"type":"Generated","category":"Country","country":"Colombia","country_code":"CO","tags":["South America"],"updated":"2023-11-24T18:45:11.7690000Z"},
	{"map_name":"A Balanced Malaysia","map_id":"634050c7fc09dbb1e6c107c6","user_name":"Souvlaki Zeitgeist","count":101990,"type":"Generated","category":"Country","country":"Malaysia","country_code":"MY","tags":["Asia"],"updated":"2023-05-10T01:00:36.7260000Z"},
	{"map_name":"A Balanced Russia","map_id":"62e309bfac02fca31aa404b8","user_name":"Alok","count":100136,"type":"Generated","category":"Country","country":"Russia","country_code":"RU","tags":["Europe","Asia"],"updated":"2023-08-05T19:08:24.5600000Z"},
	{"map_name":"A Balanced South Africa","map_id":"62eb2b6e9e3a000003c039ad","user_name":"Jupa","count":49856,"type":"Generated","category":"Country","country":"South Africa","country_code":"ZA","tags":["Africa"],"updated":"2023-08-17T03:46:22.8880000Z"},
	{"map_name":"A Balanced Spain","map_id":"62f439cfe46df79befe5c5f8","user_name":"John Harvey Kellogg","count":100000,"type":"Generated","category":"Country","country":"Spain","country_code":"ES","tags":["Europe"],"updated":"2024-03-23T20:37:40.5680000Z"},
	{"map_name":"A Balanced World","map_id":"5d73f83d82777cb5781464f2","user_name":"Debre","count":21600,"type":"Handpicked","category":"World","updated":"2023-10-19T15:30:51.4470000Z"},
	{"map_name":"A Bridged World","map_id":"643414094f0040a1616c3e5f","user_name":"[TNT] Kirania","count":100254,"type":"Generated","category":"World","tags":["Themed"],"updated":"2023-04-10T14:06:20.6500000Z"},
	{"map_name":"A Community Europe","map_id":"642879e3292b51987fb56fe0","user_name":"Simi","count":43636,"type":"Handpicked","category":"Continent","tags":["Europe"],"updated":"2024-01-09T00:33:03.1160000Z"},
	{"map_name":"A Community USA","map_id":"635c797dac045a96b9333016","user_name":"UltraTech66","count":49998,"type":"Handpicked","category":"Country","country":"United States of America","country_code":"US","tags":["North America"],"updated":"2024-03-19T14:00:31.6090000Z"},
	{"map_name":"A Community World","map_id":"62a44b22040f04bd36e8a914","user_name":"MatePotato","count":107564,"type":"Handpicked","category":"World","tags":["Pinpointable"],"updated":"2024-04-03T12:55:48.3150000Z"},
	{"map_name":"A Complete World","map_id":"5cabd6f4e92b0c36e0d5e84f","user_name":"Cactus","count":10661,"type":"Handpicked","category":"World","tags":["Unofficial Coverage (partial)"],"updated":"2021-08-23T21:37:52.8050000Z"},
	{"map_name":"A Diverse Iran","map_id":"65215f9de943811df6d5bf72","user_name":"KÃ¼gul","count":300,"type":"Handpicked","category":"Country","country":"Iran","country_code":"IR","tags":["Unofficial Coverage (only)"],"updated":"2023-12-21T11:59:54.3700000Z"},
	{"map_name":"A Divisional World","map_id":"61121b1e88f8fa0001407821","user_name":"HugoCL","count":20187,"type":"Handpicked","category":"World","tags":["Themed","Borders"],"updated":"2024-03-31T04:03:42.7750472+00:00"},
	{"map_name":"A Kirania Generated World","map_id":"64a0313ef97b3cdd7ffae216","user_name":"[TNT] Kirania","count":47680,"type":"Generated","category":"World","tags":["Meme"],"updated":"2024-01-24T07:42:42.8290000Z"},
	{"map_name":"A Mural World â€“ Official Street View Only","map_id":"637d2e28952d1f3af7564db7","user_name":"Hugo","count":2059,"type":"Handpicked","category":"World","tags":["Themed"],"updated":"2023-08-14T05:59:33.2040000Z"},
	{"map_name":"A Pinpointable World","map_id":"6029991c5048850001d572a9","user_name":"ttv.Sverre","count":3763,"type":"Handpicked","category":"World","tags":["Pinpointable"],"updated":"2024-01-04T22:13:43.7060000Z"},
	{"map_name":"A Rainbolt World","map_id":"65c86935d327035509fd616f","user_name":"rainbolt","count":110993,"type":"Generated","category":"World","updated":"2024-02-11T06:33:20.5110000Z"},
	{"map_name":"A Random Pan and Zoom World","map_id":"650236876f4b3e608b9549c2","user_name":"Pencil Vulture","count":106012,"type":"Generated","category":"World","tags":["Skewed","Meme"],"updated":"2024-03-27T07:20:27.6700000Z"},
	{"map_name":"A Rural World","map_id":"5be0de51fe3a84037ca36447","user_name":"Topotic (YT)","count":22951,"type":"Handpicked","category":"World","tags":["Rural"],"updated":"2023-10-25T01:20:20.2870000Z"},
	{"map_name":"A Skewed Rural World","map_id":"65d2fd35db7bd9b93b2a8a1b","user_name":"miracle whips","count":127872,"type":"Generated","category":"World","tags":["Skewed","Rural"],"updated":"2024-02-19T11:22:25.6263530+00:00"},
	{"map_name":"A Skewed World","map_id":"6165f7176c26ac00016bca3d","user_name":"Mars","count":68250,"type":"Generated","category":"World","tags":["Skewed"],"updated":"2024-04-01T22:58:42.9200000Z"},
	{"map_name":"A Soiled World","map_id":"607d8ba950996a00015439cc","user_name":"Havrd","count":1774,"type":"Handpicked","category":"World","tags":["Themed","Skewed"],"updated":"2022-01-30T16:16:37.1120000Z"},
	{"map_name":"A Stochastic Populated World","map_id":"61f5026376f7be0001e1eb84","user_name":"MiraMatt","count":125341,"type":"Generated","category":"World","updated":"2024-03-22T17:21:44.5520000Z"},
	{"map_name":"A Temporal World","map_id":"659521cc465cd313b9101c94","user_name":"miracle whips","count":105367,"type":"Generated","category":"World","tags":["Old Coverage (partial)"],"updated":"2024-01-03T09:03:26.2390000Z"},
	{"map_name":"A Totally Normal Zoom World","map_id":"61c24e2a3f5016000156ed74","user_name":"ananananananananananananananah","count":37160,"type":"Generated","category":"World","tags":["Skewed","Meme"],"updated":"2024-03-28T16:00:59.8670000Z"},
	{"map_name":"A Varied World","map_id":"64ce812adc7614680516ff8c","user_name":"hogmaniA","count":105600,"type":"Handpicked","category":"World","updated":"2024-04-03T20:55:28.4935312+00:00"},
	{"map_name":"A Vegetation World","map_id":"5d42203441d2a43c1cd611a8","user_name":"Alok","count":31216,"type":"Handpicked","category":"World","tags":["Themed","Vegetation","Unofficial Coverage (partial)"],"updated":"2023-04-08T21:26:08.6930000Z"},
	{"map_name":"A Well-Covered World","map_id":"64d8c5ec3a31de27be286d6c","user_name":"0xGG","count":13980,"type":"Generated","category":"World","updated":"2024-04-03T06:54:06.6968257+00:00"},
	{"map_name":"A World of Plants","map_id":"630ccd1d612a29ef2a3913a2","user_name":"atillandsia","count":1331,"type":"Handpicked","category":"World","tags":["Themed","Vegetation"],"updated":"2023-11-16T18:43:05.2940000Z"},
	{"map_name":"Aesthetic World","map_id":"611e70006033f40001dc13d6","user_name":"baszmania","count":2213,"type":"Handpicked","category":"World","tags":["Themed","Beauty"],"updated":"2024-03-22T14:58:19.6430000Z"},
	{"map_name":"AI Degenerated World","map_id":"6367bcd862285023a1d61e75","user_name":"ð•°ð–’ð–Ž_ðŸ™ðŸ›ðŸ™ðŸš","count":111011,"type":"Generated","category":"World","tags":["Meme"],"updated":"2024-03-23T01:00:56.1240000Z"},
	{"map_name":"AI gen - Argentina","map_id":"62af3a91e924b273d60d6c1e","user_name":"Kodiak","count":50817,"type":"Generated","category":"Country","country":"Argentina","country_code":"AR","tags":["South America"],"updated":"2023-12-26T14:18:43.7760000Z"},
	{"map_name":"AI gen - Indonesia","map_id":"619086606e5572000185a1db","user_name":"Kodiak","count":114255,"type":"Generated","category":"Country","country":"Indonesia","country_code":"ID","tags":["Asia"],"updated":"2024-02-04T16:05:04.1630000Z"},
	{"map_name":"AI gen - Mexico","map_id":"63382d2cc00816fde6cd69b6","user_name":"Kodiak","count":104951,"type":"Generated","category":"Country","country":"Mexico","country_code":"MX","tags":["North America"],"updated":"2023-12-05T17:44:08.4190000Z"},
	{"map_name":"AI gen - New Zealand","map_id":"61f3f49330ad7100010d56c2","user_name":"Kodiak","count":50001,"type":"Generated","category":"Country","country":"New Zealand","country_code":"NZ","tags":["Oceania"],"updated":"2023-10-19T16:40:25.7700000Z"},
	{"map_name":"AI gen - Norway","map_id":"6256b73b244c43c4448b6e45","user_name":"Kodiak","count":50586,"type":"Generated","category":"Country","country":"Norway","country_code":"NO","tags":["Europe"],"updated":"2024-01-07T15:07:16.6140000Z"},
	{"map_name":"AI Generated Israel","map_id":"63b9d90e610ea92ebae28547","user_name":"yuyu","count":40973,"type":"Generated","category":"Country","country":"Israel","country_code":"IL","tags":["Asia"],"updated":"2023-01-14T17:32:36.1060000Z"},
	{"map_name":"AI Generated World","map_id":"5dbaf08ed0d2a478444d2e8e","user_name":"RollinHill","count":135224,"type":"Handpicked","category":"World","updated":"2024-04-05T04:36:32.0740000Z"},
	{"map_name":"AI Populated World","map_id":"61f1cafb52502d0001a9a5b6","user_name":"toro3317","count":100557,"type":"Generated","category":"World","updated":"2024-03-29T14:15:59.9430000Z"},
	{"map_name":"An Arbitrary Argentina","map_id":"63a3cef9571dcbb3660427c4","user_name":"Melting Ice","count":129765,"type":"Generated","category":"Country","country":"Argentina","country_code":"AR","tags":["South America"],"updated":"2024-04-02T21:21:29.1650000Z"},
	{"map_name":"An Arbitrary Europe","map_id":"60788ebfb15d750001929514","user_name":"slashP","count":104637,"type":"Generated","category":"Continent","tags":["Europe"],"updated":"2024-04-02T23:09:22.0810000Z"},
	{"map_name":"An Arbitrary Great Plains States","map_id":"64da11103112cb9715c6a49f","user_name":"John Harvey Kellogg","count":105000,"type":"Generated","category":"Region","country":"United States of America","country_code":"US","tags":["North America"],"updated":"2023-08-14T11:40:56.4870000Z"},
	{"map_name":"An Arbitrary Indonesia","map_id":"646a47f38f006561efedc228","user_name":"Melting Ice","count":123853,"type":"Generated","category":"Country","country":"Indonesia","country_code":"ID","tags":["Asia"],"updated":"2023-05-21T16:43:07.2880000Z"},
	{"map_name":"An Arbitrary Latin America ðŸ¸","map_id":"61884a0928f77c000186f0ad","user_name":"John Harvey Kellogg","count":103533,"type":"Generated","category":"Other","tags":["North America","South America"],"updated":"2023-11-09T06:35:01.0940000Z"},
	{"map_name":"An Arbitrary Midwest","map_id":"64a6beafe509463906b9fcd4","user_name":"John Harvey Kellogg","count":104993,"type":"Generated","category":"Region","country":"United States of America","country_code":"US","tags":["North America"],"updated":"2024-02-21T03:17:30.2220000Z"},
	{"map_name":"An Arbitrary New England","map_id":"64a4f9c4a05ac4fecb6d44d8","user_name":"John Harvey Kellogg","count":104743,"type":"Generated","category":"Region","country":"United States of America","country_code":"US","tags":["North America"],"updated":"2023-07-05T05:11:37.2210000Z"},
	{"map_name":"An Arbitrary Rural World","map_id":"643dbc7ccc47d3a344307998","user_name":"slashP","count":108841,"type":"Generated","category":"World","tags":["Rural"],"updated":"2024-04-03T02:58:05.3400000Z"},
	{"map_name":"An Arbitrary Russia","map_id":"645fee824b5a2a4652553378","user_name":"Melting Ice","count":126824,"type":"Generated","category":"Country","country":"Russia","country_code":"RU","tags":["Europe","Asia"],"updated":"2024-03-30T23:10:34.6310000Z"},
	{"map_name":"An Arbitrary South America","map_id":"608e85f537802100018242e6","user_name":"slashP","count":104869,"type":"Generated","category":"Continent","tags":["South America"],"updated":"2024-04-02T23:44:18.9730000Z"},
	{"map_name":"An Arbitrary Southeast Asia","map_id":"62b557eba268d9de3c9f3487","user_name":"John Harvey Kellogg","count":86213,"type":"Generated","category":"Other","tags":["Asia"],"updated":"2023-04-19T15:07:26.6450000Z"},
	{"map_name":"An Arbitrary Southern US","map_id":"62e5cd40ca555a5e4502fae4","user_name":"John Harvey Kellogg","count":99809,"type":"Generated","category":"Region","country":"United States of America","country_code":"US","tags":["North America"],"updated":"2023-11-12T18:14:44.3390000Z"},
	{"map_name":"An Arbitrary United States","map_id":"61dfb63654e4730001e8faf5","user_name":"John Harvey Kellogg","count":104727,"type":"Generated","category":"Country","country":"United States of America","country_code":"US","tags":["North America"],"updated":"2024-03-16T05:49:16.7170000Z"},
	{"map_name":"An Arbitrary Western US","map_id":"64d9eec969787b48058990d6","user_name":"John Harvey Kellogg","count":104910,"type":"Generated","category":"Region","country":"United States of America","country_code":"US","tags":["North America"],"updated":"2023-11-20T11:26:19.7810000Z"},
	{"map_name":"An Arbitrary World","map_id":"6089bfcff6a0770001f645dd","user_name":"slashP","count":110587,"type":"Generated","category":"World","updated":"2024-04-03T00:31:35.6010000Z"},
	{"map_name":"An Equitable Stochastic Populated World","map_id":"634351287b4eaf7edc173fb6","user_name":"MiraMatt","count":124464,"type":"Generated","category":"World","updated":"2024-03-23T06:26:57.2845558+00:00"},
	{"map_name":"An Extraordinary World","map_id":"5cd30a0d17e6fc441ceda867","user_name":"Alok","count":38412,"type":"Handpicked","category":"World","tags":["Themed","Unofficial Coverage (partial)"],"updated":"2023-05-19T19:42:57.1030000Z"},
	{"map_name":"An Improved World","map_id":"5b0a80f8596695b708122809","user_name":"Wolftrekker (YT)","count":111353,"type":"Handpicked","category":"World","updated":"2024-03-29T14:05:54.6050000Z"},
	{"map_name":"An Improved World (no shitcam)","map_id":"654be9dc345a6aa922139157","user_name":"Wolftrekker (YT)","count":110000,"type":"Handpicked","category":"World","updated":"2023-11-08T20:42:19.4060000Z"},
	{"map_name":"A Curated Planet","map_id":"642a97be3c5b7968a1eb1af3","user_name":"dbldk","count":17800,"type":"Handpicked","category":"World","tags":["Skewed"],"updated":"2024-04-04T11:10:08.4249756+00:00"},
	{"map_name":"An Official World","map_id":"652ba0d9002aa0d36f996153","user_name":"La Ligue Geoguessr","count":110191,"type":"Handpicked","category":"World","updated":"2024-02-27T16:00:59.9900000Z"},
	{"map_name":"An Updated Australia","map_id":"6346e9fa501e83f27df9b372","user_name":"miracle whips","count":133357,"type":"Generated","category":"Country","country":"Australia","country_code":"AU","tags":["Oceania"],"updated":"2024-03-05T03:38:58.3210000Z"},
	{"map_name":"An Updated Japan æ—¥æœ¬","map_id":"636b89fb831db5336dde1d9e","user_name":"miracle whips","count":129985,"type":"Generated","category":"Country","country":"Japan","country_code":"JP","tags":["Asia"],"updated":"2024-01-03T05:35:13.1426010+00:00"},
	{"map_name":"An Updated New Zealand (NZ)","map_id":"633bcf49a5516b517a1fb7d7","user_name":"miracle whips","count":104493,"type":"Generated","category":"Country","country":"New Zealand","country_code":"NZ","tags":["Oceania"],"updated":"2023-12-17T08:44:20.0268365+00:00"},
	{"map_name":"An Updated Skewed World","map_id":"63ab0ab10e0b6b46cd043011","user_name":"miracle whips","count":133813,"type":"Generated","category":"World","tags":["Skewed"],"updated":"2023-12-31T04:08:42.7030000Z"},
	{"map_name":"Beauty of Streetview","map_id":"62c35b74d5781e3aba706c8a","user_name":"ProjectBloom","count":1436,"type":"Handpicked","category":"World","tags":["Themed","Beauty"],"updated":"2024-03-28T19:08:37.5190000Z"},
	{"map_name":"Big Rural Mode","map_id":"65e075f5510b256caa7818d1","user_name":"miracle whips","count":134127,"type":"Generated","category":"World","tags":["Rural"],"updated":"2024-02-29T12:37:06.5677343+00:00"},
	{"map_name":"City Skylines","map_id":"5dd60f7a44d2a445e4ae6171","user_name":"Radu C","count":1195,"type":"Handpicked","category":"World","tags":["Themed","Urban","Unofficial Coverage (partial)"],"updated":"2023-11-05T16:21:33.6890000Z"},
	{"map_name":"Dirty World","map_id":"63f3ff1e0355e40ded075e0c","user_name":"slashP","count":79128,"type":"Generated","category":"World","tags":["Rural"],"updated":"2024-04-03T04:04:12.0230000Z"},
	{"map_name":"DistanceGuessr - [Mileage signs worldwide]","map_id":"60ba136b1b6d8d0001161a1b","user_name":"quarksauce","count":2128,"type":"Handpicked","category":"World","tags":["Themed","Signs"],"updated":"2024-03-23T23:11:07.4055020+00:00"},
	{"map_name":"Extreme Regionguessing","map_id":"63cfd5ba9512ebc734807d3d","user_name":"BarrBarrBinks","count":105002,"type":"Generated","category":"World","updated":"2024-04-02T14:19:50.1180000Z"},
	{"map_name":"Frankenstein's Generator","map_id":"65475f33a93634b82d75594a","user_name":"[TNT] Kirania","count":2002,"type":"Generated","category":"World","tags":["Meme"],"updated":"2024-03-06T03:59:08.8278996+00:00"},
	{"map_name":"Geoguessr in 2069","map_id":"643b19d4490671c1730be963","user_name":"J I G E N","count":926,"type":"Handpicked","category":"World","tags":["Unofficial Coverage (only)"],"updated":"2024-03-27T21:16:29.7250000Z"},
	{"map_name":"GeoTime","map_id":"63c23ec9563ddfcf1b8cd67e","user_name":"Steve","count":134000,"type":"Generated","category":"World","updated":"2024-03-30T11:09:04.6290000Z"},
	{"map_name":"I Saw The Sign 2.0","map_id":"5cfda2c9bc79e16dd866104d","user_name":"Kirsike","count":2475,"type":"Handpicked","category":"World","tags":["Themed","Signs"],"updated":"2024-02-28T13:39:41.2890000Z"},
	{"map_name":"IntersectionGuessr","map_id":"61325442eadbec00018b6385","user_name":"slashP","count":104543,"type":"Generated","category":"World","updated":"2024-04-03T08:15:15.0453001+00:00"},
	{"map_name":"Japan â€¢ æ—¥æœ¬ 60k+","map_id":"59cf49695d2de4db80351e6e","user_name":"Ustatsch","count":62157,"type":"Handpicked","category":"Country","country":"Japan","country_code":"JP","tags":["Asia"],"updated":"2023-06-12T17:08:32.4620000Z"},
	{"map_name":"Less-Extreme Regionguessing","map_id":"658a3ef12255cca9e7f39c06","user_name":"BarrBarrBinks","count":110000,"type":"Generated","category":"World","updated":"2024-03-28T18:34:41.7630000Z"},
	{"map_name":"Our Fascinating Planet","map_id":"64eb69e1d37d724a9fb0c63d","user_name":"MatePotato","count":1597,"type":"Handpicked","category":"World","tags":["Themed","Beauty"],"updated":"2024-03-23T14:38:41.6720000Z"},
	{"map_name":"Plonk It","map_id":"617033a3759abb000106b3cb","user_name":"Scrypero","count":8040,"type":"Handpicked","category":"World","tags":["Themed"],"updated":"2024-04-01T08:24:34.2680000Z"},
	{"map_name":"Plonk It Extreme","map_id":"63b9865cbb7d2fa004826bbc","user_name":"Scrypero","count":680,"type":"Handpicked","category":"World","tags":["Themed"],"updated":"2023-09-03T11:22:39.0190000Z"},
	{"map_name":"Polska Gurom (Poland)","map_id":"65269cc7855146f08067fcd4","user_name":"miracle whips","count":104949,"type":"Generated","category":"Country","country":"Poland","country_code":"PL","tags":["Europe"],"updated":"2023-12-08T12:57:57.1860601+00:00"},
	{"map_name":"Terminus","map_id":"64919f3c95165ff26469091a","user_name":"RollinHill","count":91710,"type":"Generated","category":"World","tags":["Themed"],"updated":"2024-03-29T01:07:18.5080000Z"},
	{"map_name":"Urbanguessr","map_id":"5b0a4b154559f41f70bba679","user_name":"Wolftrekker (YT)","count":19120,"type":"Handpicked","category":"World","tags":["Urban"],"updated":"2023-10-21T19:49:40.8620000Z"}
],"date":"2024-04-05T08:00:43.631Z"};

for(const map of DATA.maps) {
	if(!map.tags) continue;
	map.tags.sort((a,b) => a.localeCompare(b));
}

let maps = DATA.maps.slice();
let selectedCol = 'map_name';
let selectedSortDir = 'asc';

function parseSortItem(item) {
	if(typeof item === 'string') {
		const s = item.toLowerCase();
		const prefixes = ['the ', 'an ', 'a '];

		for(const p of prefixes) {
			if(s.startsWith(p)) {
				return s.replace(p, '');
			}
		}
		

		return s;
	}

	return item;
}

function formatDate(str) {
	const date = new Date(str);
	const y = date.getFullYear();
	const m = (date.getMonth()+1).toString().padStart(2, '0');
	const d = date.getDate().toString().padStart(2, '0');
	return `${y}-${m}-${d}`;
}

function displayMaps(col, sort_dir) {
	selectedCol = col;
	selectedSortDir = sort_dir;

	maps.sort((a, b) => {
		a = parseSortItem(a[col]);
		b = parseSortItem(b[col]);

		if(typeof a === 'string' || typeof b === 'string') {
			if(sort_dir === 'desc') {
				return `${b}`.localeCompare(a);
			}
			return `${a}`.localeCompare(b);
		}

		return sort_dir === 'desc' ? b-a : a-b;
	});
	
	let html = ``;

	for(const map of maps) {
		html += `<tr>`;
		
		html += `<td><a href="https://www.geoguessr.com/maps/${map.map_id}" target="_blank">${map.map_name}</a></td>`;
		html += `<td>${map.user_name}</td>`;
		html += `<td>${map.count.toLocaleString()}</td>`;
		html += `<td>${map.type}</td>`;
		html += `<td>${map.category}</td>`;
		html += `<td title="${new Date(map.updated).toString()}">${formatDate(map.updated)}</td>`

		html += `<td><div class="tags">`;

		if(map.tags) {
			for(const tag of map.tags) {
				html += `<span class="tag">${tag}</span>`;
			}
		}else{
			html += `&nbsp;`
		}

		html += `</div></td>`;

		html += `</tr>`;
	}

	document.querySelector('#maps tbody').innerHTML = html;

	document.getElementById('maps').classList.toggle('is-hidden', maps.length === 0);
	document.getElementById('no-results').classList.toggle('is-hidden', maps.length > 0);
	
	for (const th of document.querySelectorAll('#maps th[data-sortable]')) {
		if(th.dataset.col === col) {
			th.dataset.sortDir = sort_dir;
		}else{
			th.dataset.sortDir = undefined;
		}
	}
}

function filterList() {
	const searchVal = document.getElementById('search').value.toLowerCase().trim();
	const shouldSearch = (!!searchVal && searchVal.length > 0);

	document.getElementById('clear-search').classList.toggle('is-hidden', searchVal.length === 0);

	const filterList = {
		locations: document.getElementById('filter-locs').value,
		type: document.getElementById('filter-type').value,
		category: document.getElementById('filter-category').value,
		tag: document.getElementById('filter-tag').value,
	}

	maps = DATA.maps.filter(map => {
		// location count filter
		switch(filterList.locations) {
			case '5k': if(map.count < 5e3) return false; break;
			case '10k': if(map.count < 10e3) return false; break;
			case '25k': if(map.count < 25e3) return false; break;
			case '50k': if(map.count < 50e3) return false; break;
			case '75k': if(map.count < 75e3) return false; break;
			case '100k': if(map.count < 100e3) return false; break;
		}

		// type filter
		if(filterList.type && filterList.type.length > 0) {
			if(map.type !== filterList.type) return false;
		}

		// category filter
		if(filterList.category && filterList.category.length > 0) {
			if(map.category !== filterList.category) return false;
		}

		// tag filter
		if(filterList.tag && filterList.tag.length > 0) {
			if(!map.tags || !map.tags.includes(filterList.tag)) return false;
		}
		
		// search query
		if(shouldSearch) {
			const terms = searchVal.split(' ');
			let matched = 0;

			termSearch: for(let term of terms) {
				term = term.trim();
				if(term.length === 0) continue;

				for(const col of ['map_name', 'user_name', 'country', 'country_code', 'updated']) {
					if(typeof map[col] !== 'string') continue;

					if(map[col].toLowerCase().includes(term)) {
						matched++;
						continue termSearch;
					}
				}
				
				if(map.tags) {
					for(const tag of map.tags) {
						if(tag.toLowerCase().includes(term)) {
							matched++;
							continue termSearch;
						}
					}
				}
			}

			return matched == terms.length;
		}

		return true;
	});

	displayMaps(selectedCol, selectedSortDir);
}

function clearSearch() {
	document.getElementById('search').value = '';
	filterList();
}

function clickedSortableCol(e) {
	e.preventDefault();

	const col = e.target.dataset.col;
	let dir;
	switch(e.target.dataset.sortDir) {
		case 'asc': dir = 'desc'; break;
		case 'desc': dir = 'asc'; break;
		default: dir = e.target.dataset.dir ?? 'asc';
	}

	displayMaps(col, dir);
}

function getTags() {
	const tagSet = new Set();
	for(const map of maps) {
		if(!map.tags) continue;

		for(const tag of map.tags) {
			tagSet.add(tag);
		}
	}

	const tagList = Array.from(tagSet).sort((a, b) => a.localeCompare(b));
	
	const tagSelect = document.getElementById('filter-tag');
	for(const tag of tagList) {
		tagSelect.innerHTML += `<option value="${tag}">${tag}</option>`;
	}
}

function reset() {
	maps = DATA.maps.slice();

	document.getElementById('search').value = '';
	document.getElementById('clear-search').classList.add('is-hidden');

	document.getElementById('filter-locs').value = '';
	document.getElementById('filter-type').value = '';
	document.getElementById('filter-category').value = '';
	document.getElementById('filter-tag').value = '';

	displayMaps(selectedCol, selectedSortDir);
}

function init() {
	document.getElementById('updated-date').textContent = formatDate(DATA.date);

	for (const th of document.querySelectorAll('#maps th[data-sortable]')) {
		th.addEventListener('click', clickedSortableCol);
	}

	document.getElementById('reset').addEventListener('click', reset);

	displayMaps(selectedCol, selectedSortDir);

	getTags();

	document.getElementById('search').addEventListener('change', filterList);
	document.getElementById('search').addEventListener('keyup', filterList);
	document.getElementById('filter-locs').addEventListener('change', filterList);
	document.getElementById('filter-type').addEventListener('change', filterList);
	document.getElementById('filter-category').addEventListener('change', filterList);
	document.getElementById('filter-tag').addEventListener('change', filterList);
	document.getElementById('clear-search').addEventListener('click', clearSearch);
}

init();
